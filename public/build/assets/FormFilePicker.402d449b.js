import{w as b,x as r,G as c,O as C,P as V,M as B,Q as f,E as D,A as I,B as O,C as y,d as u,a3 as M,l as A,s as R,y as x,Y as L,a4 as N,_ as T}from"./vue.m.04f36914.js";import{i as Z,d as q,Y,a2 as z,Z as G,_ as Q,a3 as W}from"./Api.67876f72.js";const H={key:0,class:"gap-2 columns-2 md:columns-3 lg:columns-4 mb-4 space-y-2"},J={key:0,class:"absolute inset-0 text-4xl font-bold text-black/80 flex justify-center items-center"},K=["onClick"],X=["src","data-upload-percent"],ee={__name:"PreviewImages",props:{images:{type:[Array,Object],default:()=>[]}},setup(o){const v=o,s=(d,i)=>{confirm("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435?")&&Y("file/delete","post",{id:d}).success(t=>{v.images.splice(i,1)}).run()};return b(v.images,d=>{d.forEach((i,t)=>{i.error&&v.images.splice(t,1)})},{deep:!0}),(d,i)=>o.images.length?(r(),c("div",H,[(r(!0),c(C,null,V(o.images,(t,h)=>(r(),c("div",{key:h,class:"relative p-1"},[t!=null&&t.uploading?(r(),c("div",J,B(t.uploadPercent)+"% ",1)):f("",!0),t!=null&&t.complete?(r(),c("button",{key:1,class:"absolute top-1 right-1 text-md",onClick:D(P=>s(t.id,h),["prevent"])},[I(q,{path:O(Z)},null,8,["path"])],8,K)):f("",!0),y("img",{src:t.imageObj,"data-upload-percent":t.uploadPercent,alt:"",class:"w-auto ring-4 ring-gray-300 shadow-md"},null,8,X)]))),128))])):f("",!0)}},te=y("div",{class:"mb-2 font-semibold w-full text-center"}," \u0417\u043E\u043D\u0430 \u0434\u043B\u044F \u043F\u0435\u0440\u0435\u0442\u0430\u0441\u043A\u0438\u0432\u0430\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u043E\u0432 ",-1),le={class:"flex items-stretch justify-start relative"},ae={class:"inline-flex"},oe=["accept"],ne={__name:"FormFilePicker",props:{modelValue:{type:[Object,File,Array],default:null},label:{type:String,default:"Upload"},icon:{type:String,default:z},accept:{type:String,default:null},color:{type:String,default:"info"},dropZone:{default:!0},enablePreview:{default:!0},test:{type:Boolean,default:null},mode:{type:String,default:"create"},model:{required:!0,type:String},model_id:{type:Number,default:0},dataPreviews:{type:Array,default:()=>[]}},emits:["update:modelValue","dropPreview"],setup(o,{emit:v}){const s=o,d=s.test;let i=u(null);d&&(i.value=M(()=>T(()=>import("./FormFilePickerTest.13b52304.js"),["assets/FormFilePickerTest.13b52304.js","assets/FormTestSetting.8d2629ba.js","assets/FormControl.54a2285b.js","assets/vue.m.04f36914.js","assets/adminApp.a00db8f6.js","assets/adminApp.98f8526d.css","assets/index.2a7b1da3.js","assets/Api.67876f72.js","assets/FormCheckRadioPicker.b74dcdfd.js","assets/testComponentStore.f94cb835.js"])));const t=u({}),h=()=>{const e=t.value;if(e.upload){const l=a=>{F({target:{files:a}})};e.testFiles.length&&e.mode=="create"&&l(e.testFiles),b(()=>e.testFiles,a=>{console.log("watched"),l(a)}),console.log("run test",d.mode)}};b(t,e=>{var l;console.log("runned from watch"),e&&(h(),(l=e.previews)!=null&&l.length&&(_.value=e.previews),Object.assign(P,e))},{deep:!0}),u(s.mode);const P=A({mode:u(s.mode),model:s.model,model_id:s.model_id,previews:s.dataPreviews}),$=u(null),p=u(s.modelValue),_=u([]),E=R(()=>s.modelValue);b(E,e=>{p.value=e,e||($.value.input.value=null)});const S=(e,l)=>{if(!e.type.startsWith("image/"))return alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");const a=new FileReader;a.addEventListener("load",g=>{l(g.target.result)}),a.readAsDataURL(e)},U=e=>{let l=0;const a=Math.floor(Math.random()*30),g=setInterval(()=>{l+=a,l>=100?(clearInterval(g),e(100,!0)):e(l)},1e3)},w=u(null),F=e=>{const l=e.target.files||e.dataTransfer.files;p.value=l,v("update:modelValue",p.value.length);for(let a=0;a<p.value.length;a++)S(p.value[a],g=>{const m=A({imageObj:g,uploadPercent:0,complete:!1,uploading:!0,error:null});_.value.push(m),t.value.run&&t.value.mode=="create"&&setTimeout(function(){m.complete=!1,U((n,k)=>{m.uploadPercent=n,k&&(m.complete=!0)})},2e3),W("file/upload",{model:s.model,relate_id:P.model_id,files:p.value[a]}).setErrors(w).onUploadProgress(n=>{console.log("upload",n.loaded,n.total),m.uploadPercent=Math.round(n.loaded*100/n.total)}).complete((n,k)=>{var j;Object.assign(m,{complete:!0,uploading:!1,id:(j=k[0])==null?void 0:j.id,error:!n})}).run()})};return(e,l)=>(r(),c(C,null,[(r(),x(L(O(i)),{testProps:t.value,"onUpdate:testProps":l[0]||(l[0]=a=>t.value=a)},null,40,["testProps"])),_.value.length&&o.enablePreview?(r(),x(ee,{key:0,images:_.value},null,8,["images"])):f("",!0),w.value?(r(),x(G,{key:1,errors:w.value},null,8,["errors"])):f("",!0),o.dropZone?(r(),c("div",N({key:2,class:"w-full p-4 border-slate-400 border-2 border-dashed text-slate-500 mb-2"},e.$attrs),[te,y("div",le,[y("label",ae,[I(Q,{as:"a",label:o.label,icon:o.icon,color:o.color},null,8,["label","icon","color"]),y("input",{ref_key:"root",ref:$,type:"file",class:"absolute top-0 left-0 w-full h-full opacity-0 outline-none cursor-pointer -z-1",accept:o.accept,onInput:F,multiple:""},null,40,oe)])])],16)):f("",!0)],64))}};export{ne as _,ee as a};
