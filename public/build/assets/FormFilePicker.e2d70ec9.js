import{w as b,x as r,G as d,O as C,P as B,M as D,Q as f,F as E,A as I,B as O,C as y,d as n,a3 as M,l as A,s as R,y as x,Y as L,a4 as N,_ as T}from"./vue.m.26e38986.js";import{i as Z,d as q,Y,a2 as z,Z as G,_ as Q,a3 as W}from"./Api.4fdb4a26.js";const H={key:0,class:"gap-2 columns-2 md:columns-3 lg:columns-4 mb-4 space-y-2"},J={key:0,class:"absolute inset-0 text-4xl font-bold text-black/80 flex justify-center items-center"},K=["onClick"],X=["src","data-upload-percent"],ee={__name:"PreviewImages",props:{images:{type:[Array,Object],default:()=>[]}},setup(s){const v=s,o=(u,i)=>{confirm("\u0423\u0434\u0430\u043B\u0438\u0442\u044C \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u0435?")&&Y("file/delete","post",{id:u}).success(t=>{v.images.splice(i,1)}).run()};return b(v.images,u=>{u.forEach((i,t)=>{i.error&&v.images.splice(t,1)})},{deep:!0}),(u,i)=>s.images.length?(r(),d("div",H,[(r(!0),d(C,null,B(s.images,(t,h)=>(r(),d("div",{key:h,class:"relative p-1"},[t!=null&&t.uploading?(r(),d("div",J,D(t.uploadPercent)+"% ",1)):f("",!0),t!=null&&t.complete?(r(),d("button",{key:1,class:"absolute top-1 right-1 text-md",onClick:E(P=>o(t.id,h),["prevent"])},[I(q,{path:O(Z)},null,8,["path"])],8,K)):f("",!0),y("img",{src:t.imageObj,"data-upload-percent":t.uploadPercent,alt:"",class:"w-auto ring-4 ring-gray-300 shadow-md"},null,8,X)]))),128))])):f("",!0)}},te=y("div",{class:"mb-2 font-semibold w-full text-center"}," \u0417\u043E\u043D\u0430 \u0434\u043B\u044F \u043F\u0435\u0440\u0435\u0442\u0430\u0441\u043A\u0438\u0432\u0430\u043D\u0438\u044F \u0444\u0430\u0439\u043B\u043E\u0432 ",-1),le={class:"flex items-stretch justify-start relative"},ae={class:"inline-flex"},se=["accept"],ne={__name:"FormFilePicker",props:{modelValue:{type:[Object,File,Array],default:null},label:{type:String,default:"Upload"},icon:{type:String,default:z},accept:{type:String,default:null},color:{type:String,default:"info"},dropZone:{default:!0},enablePreview:{default:!0},test:{type:Boolean,default:null},mode:{type:String,default:"create"},model:{required:!0,type:String},model_id:{type:Number,default:0},dataPreviews:{type:Array,default:()=>[]}},emits:["update:modelValue","dropPreview"],setup(s,{emit:v}){const o=s,u=o.test;let i=n(null);u&&(i.value=M(()=>T(()=>import("./FormFilePickerTest.4285cce7.js"),["assets/FormFilePickerTest.4285cce7.js","assets/FormTestSetting.bf7644c3.js","assets/FormControl.ec8216db.js","assets/vue.m.26e38986.js","assets/adminApp.8b98ecb1.js","assets/adminApp.b7aba8ef.css","assets/index.fb2d0054.js","assets/Api.4fdb4a26.js","assets/FormCheckRadioPicker.80cd8c70.js","assets/testComponentStore.e44842cd.js"])));const t=n({}),h=()=>{const e=t.value;if(e.upload){const l=a=>{$({target:{files:a}})};e.testFiles.length&&e.mode=="create"&&l(e.testFiles),b(()=>e.testFiles,a=>{console.log("watched"),l(a)}),console.log("run test",u.mode)}};b(t,e=>{var l;console.log("runned from watch"),e&&(h(),(l=e.previews)!=null&&l.length&&(_.value=e.previews),Object.assign(P,e))},{deep:!0}),n(o.mode);const P=A({mode:n(o.mode),model:o.model,model_id:o.model_id,previews:o.dataPreviews}),F=n(null),c=n(o.modelValue),_=n([]),S=R(()=>o.modelValue);b(S,e=>{c.value=e,e||(F.value.input.value=null)});const U=(e,l)=>{if(!e.type.startsWith("image/"))return alert("\u0412\u044B\u0431\u0435\u0440\u0438\u0442\u0435 \u0438\u0437\u043E\u0431\u0440\u0430\u0436\u0435\u043D\u0438\u044F");const a=new FileReader;a.addEventListener("load",g=>{l(g.target.result)}),a.readAsDataURL(e)},V=e=>{let l=0;const a=Math.floor(Math.random()*30),g=setInterval(()=>{l+=a,l>=100?(clearInterval(g),e(100,!0)):e(l)},1e3)},w=n(null),$=e=>{const l=e.target.files||e.dataTransfer.files;c.value=l,v("update:modelValue",c.value.length);for(let a=0;a<c.value.length;a++)U(c.value[a],g=>{const p=A({imageObj:g,uploadPercent:0,complete:!1,uploading:!0,error:null});_.value.push(p),t.value.run&&t.value.mode=="create"&&setTimeout(function(){p.complete=!1,V((m,k)=>{p.uploadPercent=m,k&&(p.complete=!0)})},2e3),W("file/upload",{model:o.model,relate_id:P.model_id,files:c.value[a]}).setErrors(w).onUploadProgress(m=>{p.uploadPercent=Math.round(m.loaded*100/m.total)}).complete((m,k)=>{var j;Object.assign(p,{complete:!0,uploading:!1,id:(j=k[0])==null?void 0:j.id,error:!m})}).run()})};return(e,l)=>(r(),d(C,null,[(r(),x(L(O(i)),{testProps:t.value,"onUpdate:testProps":l[0]||(l[0]=a=>t.value=a)},null,40,["testProps"])),_.value.length&&s.enablePreview?(r(),x(ee,{key:0,images:_.value},null,8,["images"])):f("",!0),w.value?(r(),x(G,{key:1,errors:w.value},null,8,["errors"])):f("",!0),s.dropZone?(r(),d("div",N({key:2,class:"w-full p-4 border-slate-400 border-2 border-dashed text-slate-500 mb-2"},e.$attrs),[te,y("div",le,[y("label",ae,[I(Q,{as:"a",label:s.label,icon:s.icon,color:s.color},null,8,["label","icon","color"]),y("input",{ref_key:"root",ref:F,type:"file",class:"absolute top-0 left-0 w-full h-full opacity-0 outline-none cursor-pointer -z-1",accept:s.accept,onInput:$,multiple:""},null,40,se)])])],16)):f("",!0)],64))}};export{ne as _,ee as a};
